<!doctype html><html lang="en">
<head><meta charset="UTF-8">
<meta name="viewport" content="width=768, initial-scale=1">
<link rel="STYLESHEET" href="../css/main.css" type="text/css">
<title>traceroute Man Page - macOS - SS64.com</title>
<script async src="../js/q.js"></script>
<script async src="../js/content.js"></script>
</head><body><!-- #BeginLibraryItem "/Library/head_osx.lbi" --><div id="tnav"><ul>
<li class="tbtn"><a href="https://ss64.com/">SS64</a></li>
<li class="tbtn"><a href="../osx">macOS <svg viewBox="0 0 13 20.1" width="13" height="13" style="transform: rotate(0deg);"><path d="M0 2.9l7.2 7.2-7.1 7.1L3 20.1l7.1-7.1 2.9-2.9L2.9 0 0 2.9"></path></svg></a></li>
<li class="tbtn"><a href="syntax.html">How-to <svg viewBox="0 0 13 20.1" width="13" height="13" style="transform: rotate(0deg);"><path d="M0 2.9l7.2 7.2-7.1 7.1L3 20.1l7.1-7.1 2.9-2.9L2.9 0 0 2.9"></path></svg></a></li>
<li><div id="search"><form action="https://www.google.com/search" method="get">
<input type="text" name="q" id="qu" size="27" maxlength="255" aria-label="Search text">
<input class="submit mousetrap" value="Search" id="btn" type="submit">
<input type="hidden" name="sitesearch" value="ss64.com/osx/"></form></div></li>
</ul></div><!-- #EndLibraryItem --><h1>traceroute</h1> 
<p>Print the route that packets take to a network host.</p>
<pre>Syntax
      traceroute [<i>options</i>] host [<i>packetsize</i>]

Options<i>

</i>   <i>host</i>        Host name or IP number

   -a          Turn on AS# lookups for each hop encountered.

   -A <i>as_server</i>    Turn  on  AS# lookups and use the given server instead of the default.

   -d          Enable socket level debugging.

   -D          When an ICMP response to our probe datagram is received, print the differences between the transmitted
               packet and the packet quoted by the ICMP response.  A key showing the location of fields within the
               transmitted packet is printed, followed by the original packet in hex, followed by the quoted packet
               in hex.  Bytes that are unchanged in the quoted packet are shown as underscores.
               Note, the IP checksum and the TTL of the quoted packet are not expected to match.
               By default, only one probe per hop is sent with this option.

   -e          Firewall evasion mode.
               Use fixed destination ports for UDP and TCP probes. The destination port does NOT increment with each packet sent.

   -f <i>first_ttl</i>  Set the initial time-to-live used in the <b>first</b> outgoing probe packet.

   -F          Set the "don't fragment" bit.

   -g <i>gateway</i>  Specify a loose source route gateway (8 maximum).

   -i <i>iface</i>    Specify a network interface to obtain the source IP address for outgoing probe packets.
               This is normally only useful on a multi-homed host. (See the -s flag for another way to do this.)

   -I          Use ICMP ECHO instead of UDP datagrams.  (A synonym for "-P icmp").

   -M <i>first_ttl </i> Set the initial time-to-live value used in outgoing probe packets.
                 The default is 1, i.e., start with the first hop.

   -m <i>max</i>_<i>ttl</i>  Set the max time-to-live (max number of hops) used in outgoing  probe packets.
               The default is 30 hops (the same default used for TCP connections).

   -n          Print hop addresses numerically rather than symbolically and  numerically
               (saves a nameserver address-to-name lookup for each  gateway found on the path).

   -P <i>proto</i>    Send packets of specified IP protocol.
               The currently supported protocols are: UDP , TCP , GRE and ICMP Other protocols  may also be specified
               (either by name or by number), though traceroute does not implement any special knowledge of their
               packet formats. This option is useful for determining which router along a path may be blocking packets
               based on IP protocol number. But see BUGS below.

   -p <i>port</i>     Protocol specific. For UDP and TCP, sets the base port number used in probes (default is 33434).
               traceroute hopes that nothing is listening on UDP ports base to base+nhops-1 at the destination
               host (so an ICMP PORT_UNREACHABLE message will be returned to terminate the route tracing).
               If something is listening on a port in the default range, this option can be used to pick an unused
               port range.

  <i>packetsize</i>   The default probe datagram length is 38 bytes, but this may be increased by
               specifying a packet size (in bytes) after the destination host name.

   -q <i>nqueries</i>  Set the number of probes per `ttl' to <i>nqueries</i> (default is three probes).

   -r          Bypass the normal routing tables and send directly to a host on an attached network.
               If the host is not on a directly-attached  network, an error is returned.
               This option can be used to ping a local host through an interface that has no route through it
               (e.g., after the interface was dropped by routed(8)).

   -s <i>src</i>_<i>addr</i>  Use the following IP address (which must be given as an IP number, not a hostname) as
               the source address in outgoing probe packets.  On hosts with more than one IP address,
               this option can be used to force the source address to be something other than
               the IP address of the interface the probe packet is sent on.  If the IP address is not
               one of this machine's interface addresses, an error is returned and nothing is sent.

   -S          Print a summary of how many probes were not answered for each hop.

   -t <i>tos</i>      Set the <i>type-of-service</i> in probe packets to the following value (default zero).
               The value must be a decimal integer in the range 0 to 255.
               This option can be used to see if different types-of-service result in different paths.
               (If you are not running a 4.3BSD-Tahoe or later system, this may be academic since the normal
               network services like telnet and ftp don't let you control the TOS).
               Not all values of TOS are legal or meaningful - see the IP spec for definitions.
               Useful values are probably '-t 16' (low delay) and '-t 8' (high throughput).

   -v          Verbose output.  Received ICMP packets other than TIME_EXCEEDED and UNREACHABLEs are listed.

   -w          Set the time (in seconds) to wait for a response to a probe (default 3 sec.).

   -x          Toggle IP checksums. Normally, this prevents traceroute from calculating IP checksums.
               In some cases, the operating system can overwrite parts of the outgoing packet but not recalculate
               the checksum (so in some cases the default is to not calculate checksums and using -x causes
               them to be calculated). Note that checksums are usually required for the last hop when using
               ICMP ECHO probes ( -I ). So they are always calculated when using ICMP.

   -z <i>pausemsecs</i>
               Set the time (in milliseconds) to pause between probes (default 0).
               Some systems such as Solaris and routers such as Ciscos rate limit ICMP messages.
               A good value to use with this this is 500 (e.g. 1/2 second).</pre>
<p><span class="body"> This program attempts to trace the route an IP packet would 
  follow to some internet host by launching UDP probe packets with a small ttl 
  (time to live) then listening for an ICMP "time exceeded" reply from a gateway.<br>
  We start our probes with a ttl of one and increase by one until we get an ICMP 
  "port unreachable" (which means we got to "host") or hit a max (which defaults 
  to 30 hops &amp; can be changed with the <b>-m</b> flag). Three probes (changed 
  with <b>-q</b> flag) are sent at each ttl setting and a line is printed showing 
  the ttl, address of the gateway and round trip time of each probe. If the probe 
  answers come from different gateways, the address of each responding system 
  will be printed. If there is no response within a 3 sec. timeout interval (changed 
  with the <b>-w</b> flag), a "*" is printed for that probe.<br>
  <br>
  We don't want the destination host to process the UDP probe packets so the destination 
  port is set to an unlikely value (if some clod on the destination is using that 
value, it can be changed with the <b>-p</b> flag).</span> </p>
<pre>     A sample use and output might be:

     [yak 71]% traceroute nis.nsf.net.
     traceroute to nis.nsf.net (35.1.1.48), 30 hops max, 56 byte packet
     1 helios.ee.lbl.gov (128.3.112.1)  19 ms 19 ms  0 ms
     2 lilac-dmc.Berkeley.EDU (128.32.216.1)  39 ms  39 ms  19 ms
     3 lilac-dmc.Berkeley.EDU (128.32.216.1)  39 ms  39 ms  19 ms
     4 ccngw-ner-cc.Berkeley.EDU (128.32.136.23)  39 ms  40 ms  39 ms
     5 ccn-nerif22.Berkeley.EDU (128.32.168.22)  39 ms  39 ms 39 ms
     6 128.32.197.4 (128.32.197.4)  40 ms  59 ms  59 ms
     7 131.119.2.5 (131.119.2.5)  59 ms  59 ms  59 ms
     8 129.140.70.13 (129.140.70.13)  99 ms  99 ms  80 ms
     9 129.140.71.6 (129.140.71.6)  139 ms  239 ms  319 ms
     10  129.140.81.7 (129.140.81.7)  220 ms  199 ms  199 ms
     11  nic.merit.edu (35.1.1.48)  239 ms  239 ms  239 ms
     Note that lines 2 &amp; 3 are the same.  This is due to a buggy kernel on the
     2nd hop system - lbl-csam.arpa - that forwards packets with a zero ttl (a
     bug in the distributed version of 4.3 BSD).  Note that you have to guess
     what path the packets are taking cross-country since the NSFNet (129.140)
     doesn't supply address-to-name translations for its NSSes.

     A more interesting example is:

     [yak 72]% traceroute allspice.lcs.mit.edu.
     traceroute to allspice.lcs.mit.edu (18.26.0.115), 30 hops max
     1 helios.ee.lbl.gov (128.3.112.1)  0 ms  0 ms  0 ms
     2 lilac-dmc.Berkeley.EDU (128.32.216.1)  19 ms  19 ms  19 ms
     3 lilac-dmc.Berkeley.EDU (128.32.216.1)  39 ms  19 ms  19 ms
     4 ccngw-ner-cc.Berkeley.EDU (128.32.136.23)  19 ms  39 ms  39 ms
     5 ccn-nerif22.Berkeley.EDU (128.32.168.22)  20 ms  39 ms 39 ms
     6 128.32.197.4 (128.32.197.4)  59 ms  119 ms  39 ms
     7 131.119.2.5 (131.119.2.5)  59 ms  59 ms  39 ms
     8 129.140.70.13 (129.140.70.13)  80 ms  79 ms  99 ms
     9 129.140.71.6 (129.140.71.6)  139 ms  139 ms  159 ms
     10  129.140.81.7 (129.140.81.7)  199 ms  180 ms  300 ms
     11  129.140.72.17 (129.140.72.17) 300 ms 239 ms 239 ms
     12  * * *
     13  128.121.54.72 (128.121.54.72) 259 ms 499 ms 279 ms
     14  * * *
     15  * * *
     16  * * *
     17  * * *
     18  ALLSPICE.LCS.MIT.EDU (18.26.0.115)  339 ms  279 ms  279 ms
     Note that the gateways 12, 14, 15, 16 &amp; 17 hops away either don't send
     ICMP "time exceeded" messages or send them with a ttl too small to reach
     us.  14 - 17 are running the MIT C Gateway code that doesn't send "time
     exceeded"s.  God only knows what's going on with 12.

     The silent gateway 12 in the above may be the result of a bug in the
     4.[23] BSD network code (and its derivatives):  4.x (x &lt;= 3) sends an
     unreachable message using whatever ttl remains in the original datagram.
     Since, for gateways, the remaining ttl is zero, the ICMP "time exceeded"
     is guaranteed to not make it back to us.  The behavior of this bug is
     slightly more interesting when it appears on the destination system:

     1 helios.ee.lbl.gov (128.3.112.1)  0 ms  0 ms  0 ms
     2 lilac-dmc.Berkeley.EDU (128.32.216.1)  39 ms  19 ms  39 ms
     3 lilac-dmc.Berkeley.EDU (128.32.216.1)  19 ms  39 ms  19 ms
     4 ccngw-ner-cc.Berkeley.EDU (128.32.136.23)  39 ms  40 ms  19 ms
     5 ccn-nerif35.Berkeley.EDU (128.32.168.35)  39 ms  39 ms 39 ms
     6 csgw.Berkeley.EDU (128.32.133.254)  39 ms  59 ms  39 ms
     7 * * *
     8 * * *
     9 * * *
     10  * * *
     11  * * *
     12  * * *
     13  rip.Berkeley.EDU (128.32.131.22)  59 ms !  39 ms !  39 ms !</pre>
<p> Notice that there are 12 "gateways" (13 is the final destination) and
exactly the last half of them are "missing".  What's really happening is<br>
that rip (a Sun-3 running Sun OS3.5) is using the ttl from our arriving
datagram as the ttl in its ICMP reply.  </p>
<p>So, the reply will time out on
the return path (with no notice sent to anyone since ICMP's aren't sent
for ICMP's) until we probe with a ttl that's at least twice the path
length.  I.e., rip is really only 7 hops away.  A reply that returns with
a ttl of 1 is a clue this problem exists.</p>
<p> <b>Traceroute</b> prints a "!" after
the time if the ttl is &lt;= 1.  Since vendors ship a lot of obsolete (DEC's
Ultrix, Sun 3.x) or non-standard (HPUX) software, expect to see this
problem frequently and/or take care picking the target host of your
probes.  </p>
<p>Other possible annotations after the time are <b>!H</b>, <b>!N</b>, <b>!P</b> (got a
host, network or protocol unreachable, respectively), <b>!S</b> or <b>!F</b> (source
route failed or fragmentation needed - neither of these should ever occur
and the associated gateway is busted if you see one).  If almost all the
probes result in some kind of unreachable, <b>traceroute</b> will give up and
exit.<br>
<br>
This program is intended for use in network testing, measurement and management.  It should be used primarily for manual fault isolation.<br>
Because of the load it could impose on the network, it is unwise to use <b>traceroute</b> during normal operations or from automated scripts.</p>
<p class="quote"><i>&ldquo;The Net interprets censorship as damage and routes around it&rdquo; ~ John Gilmore</i></p>
<h3>Related macOS commands</h3>
<p class="space"> netstat - Show network status.<br>
<a href="ping.html">ping</a> - Test a network connection.<br>
<a href="traceroute6.html">traceroute6</a> - Trace IPv6 Route to Host</p><!-- #BeginLibraryItem "/Library/foot_osx.lbi" --><!-- AuctionX Display platform tag START -->
<div id="27677x300x250x4627x_ADSLOT1" clickTrack="%%CLICK_URL_ESC%%"></div>
<script async src="https://served-by.pixfuture.com/www/delivery/headerbid.js" slotId="27677x300x250x4627x_ADSLOT1" refreshTime="5" refreshInterval="120"></script><!-- AuctionX Display platform tag END -->
<hr>
<div id=bl>&nbsp;</div>
<div id=br>Copyright &copy; 1999-2023 <a href="https://ss64.com/">SS64.com</a><br>
Some rights reserved</div><!-- #EndLibraryItem --></body>
</html>
